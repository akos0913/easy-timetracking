{% extends "base.html" %}

{% block head %}
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}

{% block content %}
  <div class="stack" x-data="timeTracking()">
    <div class="row-between">
      <div>
        <h1 class="h1">Zeiterfassung</h1>
        <p class="hint">Status und Tagesübersicht für deine Sessions.</p>
      </div>
      <div class="row row-align">
        <span class="badge">Eingeloggt als {{ username }}</span>
        <form method="post" action="/logout">
          <button class="btn btn-secondary" type="submit">Logout</button>
        </form>
      </div>
    </div>

    <section class="surface">
      <div class="row-between">
        <div>
          <p class="hint">Aktueller Status</p>
          <p class="section-title" x-text="status"></p>
        </div>
        <div class="row">
          <button class="btn btn-primary" @click="startSession">Start</button>
          <button class="btn btn-danger" @click="stopSession">Stop</button>
        </div>
      </div>
    </section>

    <section class="surface">
      <div class="row-between">
        <div>
          <h2 class="section-title">Tagesansicht</h2>
          <p class="hint">Sessions für das gewählte Datum.</p>
        </div>
        <div class="form-row form-row-compact">
          <label class="label" for="sessionDate">Datum</label>
          <input
            id="sessionDate"
            type="date"
            class="input"
            x-model="selectedDate"
            @change="loadSessions"
          />
        </div>
      </div>

      <div class="table-wrap mt-6">
        <table class="table">
          <thead>
            <tr>
              <th>Start</th>
              <th>Ende</th>
              <th>Notiz</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="session in sessions" :key="session.id">
              <tr>
                <td x-text="formatDate(session.start_time)"></td>
                <td x-text="session.end_time ? formatDate(session.end_time) : 'läuft'"></td>
                <td>
                  <div class="table-note">
                    <input
                      type="text"
                      class="input"
                      placeholder="Notiz hinzufügen"
                      x-model="session.note"
                    />
                    <button class="btn btn-primary" @click="saveNote(session)">Speichern</button>
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/static/app.js"></script>
{% endblock %}
