{% extends "base.html" %}

{% block head %}
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}

{% block header_actions %}
  <div class="flex items-center gap-4">
    <span class="helper-text">Eingeloggt als {{ username }}</span>
    <form method="post" action="/logout">
      <button class="btn btn-secondary" type="submit">Logout</button>
    </form>
  </div>
{% endblock %}

{% block content %}
  <div class="space-y-6" x-data="timeTracking()">
    <div>
      <h1 class="page-title">Zeiterfassung</h1>
      <p class="helper-text mt-2">Status und Tagesübersicht für deine Sessions.</p>
    </div>

    <section class="card">
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <div>
          <p class="helper-text">Aktueller Status</p>
          <p class="section-title mt-1" x-text="status"></p>
        </div>
        <div class="flex flex-wrap gap-3">
          <button class="btn btn-primary" @click="startSession">Start</button>
          <button class="btn btn-secondary" @click="stopSession">Stop</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h2 class="section-title">Tagesansicht</h2>
          <p class="helper-text mt-1">Sessions für das gewählte Datum.</p>
        </div>
        <div class="w-full md:w-56">
          <label class="block text-sm font-medium mb-2" for="sessionDate">Datum</label>
          <input
            id="sessionDate"
            type="date"
            class="input"
            x-model="selectedDate"
            @change="loadSessions"
          />
        </div>
      </div>

      <div class="mt-6 overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th>Start</th>
              <th>Ende</th>
              <th>Notiz</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="session in sessions" :key="session.id">
              <tr>
                <td x-text="formatDate(session.start_time)"></td>
                <td x-text="session.end_time ? formatDate(session.end_time) : 'läuft'"></td>
                <td>
                  <div class="flex flex-col gap-2 md:flex-row md:items-center">
                    <input
                      type="text"
                      class="input"
                      placeholder="Notiz hinzufügen"
                      x-model="session.note"
                    />
                    <button class="btn btn-primary" @click="saveNote(session)">Speichern</button>
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/static/app.js"></script>
{% endblock %}
